---
layout: post
title: Google Summer of Code and Pander - Part II
comments: True
---

This article is the second part of the review of participation in GSoC with R project working on pander package. First part is available here. 

### My plan for GSoC 2015

While I worked on many small things here and there, and besides documentation and testing, my main goals stated in the proposal for the summer were:

* [extend generic S3 method with new classes](.#adding-new-s3-methods)
* [refactor pandoc.table and evals](.#adding-configurable-column-width)
* [extend test-suite and introduce unified coding style](#rewriting-core-functionality-with-rcpp)
* [improve documentation and create topic specific vignettes](#rewriting-core-functionality-with-rcpp)

My full application is available [here](https://github.com/RomanTsegelskyi/pi-blog/raw/gh-pages/_includes/gsoc-2014.pdf).

#### Adding new S3 methods

This year, as well as last year I worked on extending generic S3 method with new supported classes:

* [pander.tabular](https://github.com/Rapporter/pander/pull/161)
* [pander.summary.table](https://github.com/Rapporter/pander/pull/181)
* [pander.randomForest](https://github.com/Rapporter/pander/pull/184)
* [pander.gtable](https://github.com/Rapporter/pander/pull/198)
* [pander.irts](https://github.com/Rapporter/pander/pull/197)
* [pander.nls/summary.nls](https://github.com/Rapporter/pander/pull/199)
* [pander.manova/summary.manova](https://github.com/Rapporter/pander/pull/202)
* [pander.arima](https://github.com/Rapporter/pander/pull/210)
* [pander.ols/rms/Glm/cph/lrm/summary.rms](https://github.com/Rapporter/pander/pull/212)
* [pander.polr/summary.polr](https://github.com/Rapporter/pander/pull/217)
* [pander.survreg/summary.survreg](https://github.com/Rapporter/pander/pull/218)

This effort is the one I am particularly proud of, since overall while working on `pander` I added around 30 new S3 methods, bringing the total number to 73 and making `pander` of the most covering packages among the once with similar functionality like `xtable`, `ascii` etc. 

#### Testing

Between GSoC 2014 and GSoC 2015 Jim Hester created [covr](https://github.com/jimhester/covr/) package for measuring test coverage. Around the same time I was also inverstigating possibilities to measure R code coverage as part of my [research](https://github.com/allr/rcov), so I was searching for work done and covr presented a robust and general solution for the problem. Since it was quickly picked up by [coveralls.io](https://coveralls.io) and [codecov.io](https://codecov.io), so I integrated it in `pander`'s Travis configuration as soon as it was [available](https://github.com/Rapporter/pander/pull/151). The existing test suite in `pander` gave 54% coverage, which was a good start, but not enough, since I wanted to do the refactoring and wanted more robust testing before that. So firstly, I decided to extend the test suite. As most of uncovered code was in S3 methods, which made me thing what is the best way to test such methods. After some evaluation, I decided to test the length of output and some characteristics certain not to change even in underslying implementation of `pandoc.table` changes. 

**Add pull requests here.**

While working on that I also realized that due to limitations in R, covr won't treat one line if statements correctly. So this emergend into big refactoring, to combine linting and change of braces which was implemented in [PR #196](https://github.com/Rapporter/pander/pull/196) with addition of [PR #215](https://github.com/Rapporter/pander/pull/215) when I figure out how to create a linter to enforce single quotes. 

All those efforts brought coverage to 78%, which we considered good, since large uncovered area in evals is hard to test, however that might change once robust package like [vtest](https://github.com/wch/vtest) is developed for R. 

#### Refactoring pandoc.table and evals

Over the time `pandoc.table` and `evals` grew to be rather complex functions, which made it much harder to introduce any new functionality. So I embarced the idea to refactor them. My first destination was to refactor `pandoc.table`. As Gergely pointed out, a lot of redundant complexity in `pandoc.table` comes from the fact that it supports input of different dimensions, which in turn required a lot of checks to overcome that. So I started with creating an intermediate representation (https://github.com/RomanTsegelskyi/pander/commit/91564e53ab01327efa1ee890bf6a048e998abf18)



#### Documentation and vignettes

### Aftermath

Some statistics of my work during this awesome experience:

* 127 commits
* 40 accepted pull requests
* 14 new pander methods
* 4026 lines inserted, 1459 lines deleted
* 4 bugs fixed

But those numbers don't reflect more important change that I think GSoC is about. I was able to participate in something that is largely used and was able to contribute to R community while learning a lot about R package development (for example documenting with [roxygen](https://cran.r-project.org/web/packages/roxygen2/index.html), testing with [testthat](https://cran.r-project.org/web/packages/testthat/index.html) and CI with [Travis](travis-ci.org)). All in all, it was such a great experience that I was happy to return for GSoC 2015...
